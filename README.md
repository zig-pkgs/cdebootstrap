# cdebootstrap-zig

This project is a rewrite of the original `cdebootstrap` in the Zig programming language. The primary goal is to produce a fully static `cdebootstrap` executable with no external runtime dependencies. This is achieved by progressively replacing the original C code and its dependencies with Zig's powerful standard library and build system.

## Why Zig?

- **Memory Safety:** Zig provides stronger memory safety guarantees compared to C, helping to prevent common bugs like buffer overflows and null pointer dereferences.
- **Build System:** Zig's integrated build system simplifies dependency management and cross-compilation, making it straightforward to produce static binaries for various architectures.
- **Standard Library:** Zig's standard library is comprehensive and offers modern APIs for tasks like HTTP requests, compression, and file system manipulation, which helps in eliminating the need for external C libraries like `libcurl`, `zlib`, and `liblzma`.

## Current Status

This project is a work in progress. Here is a summary of the current state:

- **Build System:** The original `autotools`-based build system has been completely replaced with Zig's `build.zig`.
- **Decompression:**
    - `gzip` and `xz` decompression are now handled by Zig's standard library (`std.compress.flate` and `std.compress.xz`), removing the dependency on `zlib` and `liblzma`.
    - `bzip2` decompression still relies on the `bzip2` C library.
- **Package Extraction:** The logic for extracting `.deb` packages is partially ported. The `ar` archive parsing is implemented in `lib/ar.zig`. The tar extraction still shells out to the `tar` command, but the decompression of the stream is handled by Zig.
- **Downloading:** The download functionality, which previously used `libcurl`, has been replaced with Zig's `std.http.Client`.
- **Helper Packages:** The helper `.deb` packages are now generated by a Zig program (`helper/src/main.zig`) that creates the necessary `ar` and `tar` archives from the files in the `helper/` directory.

## Building the Project

To build the project, you will need a recent version of the Zig compiler (0.16.0-dev or newer).

```sh
zig build
```

This command will compile the project and place the `cdebootstrap` executable in the `zig-out/bin` directory.

## Usage

The command-line interface is intended to be compatible with the original `cdebootstrap`.

```
./zig-out/bin/cdebootstrap [OPTION]... [ORIGIN/]CODENAME TARGET [MIRROR]
```

**Example:**

```sh
zig build
sudo ./zig-out/bin/cdebootstrap sid ./sid-rootfs http://deb.debian.org/debian
```

For a full list of options, please refer to the man page or use the `--help` flag.

## Dependencies

The ultimate goal is to have zero runtime dependencies.

- **Removed:** `libcurl`, `zlib`, `liblzma`.
- **Remaining:** `libbz2`. The C standard library is also still a dependency for the parts of the codebase that are still written in C.

## Future Goals

- Replace the `bzip2` C dependency with a pure Zig implementation.
- Continue porting the remaining C code in `src/` to idiomatic Zig.
- Eliminate the dependency on the C standard library entirely.

## Contributing

Contributions are welcome! If you are interested in helping out, please feel free to open an issue to discuss your ideas or submit a pull request.
